<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- SLA Policy List View -->
    <record id="view_technical_service_sla_list" model="ir.ui.view">
        <field name="name">technical.service.sla.list</field>
        <field name="model">technical_service.sla</field>
        <field name="arch" type="xml">
            <list string="SLA Policies" create="1" edit="1">
                <field name="name"/>
                <field name="x_apply_to"/>
                <field name="x_business_hours_start" widget="float_time"/>
                <field name="x_business_hours_end" widget="float_time"/>
                <field name="x_include_weekends"/>
                <field name="x_enable_escalation"/>
                <field name="active" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- SLA Policy Form View -->
    <record id="view_technical_service_sla_form" model="ir.ui.view">
        <field name="name">technical.service.sla.form</field>
        <field name="model">technical_service.sla</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <widget name="web_ribbon" title="Inactive"
                            bg_color="text-bg-danger"
                            invisible="active"/>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="SLA Policy Name..."/>
                        </h1>
                    </div>
                    <group>
                        <group string="Applicability">
                            <field name="x_apply_to" required="1"/>
                            <field name="x_service_category_ids"
                                   invisible="x_apply_to != 'category'"
                                   required="x_apply_to == 'category'"/>
                            <field name="x_campus_ids"
                                   invisible="x_apply_to != 'location'"
                                   required="x_apply_to == 'location'"/>
                            <field name="x_partner_ids"
                                   invisible="x_apply_to != 'customer'"
                                   required="x_apply_to == 'customer'"/>
                        </group>
                        <group string="Business Hours">
                            <field name="x_business_hours_start" widget="float_time"/>
                            <field name="x_business_hours_end" widget="float_time"/>
                            <field name="x_include_weekends"/>
                            <field name="x_timezone"/>
                            <field name="active" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="SLA Targets" name="targets">
                            <field name="x_line_ids">
                                <list editable="bottom" create="1" delete="1">
                                    <field name="x_priority" required="1"/>
                                    <field name="x_response_time" widget="float_time"/>
                                    <field name="x_resolution_time" widget="float_time"/>
                                    <field name="x_after_hours_response" widget="float_time"/>
                                    <field name="x_after_hours_resolution" widget="float_time"/>
                                </list>
                            </field>
                        </page>
                        <page string="Escalation Rules" name="escalation">
                            <group>
                                <field name="x_enable_escalation"/>
                            </group>
                            <field name="x_escalation_rules_ids" invisible="not x_enable_escalation">
                                <list editable="bottom" create="1" delete="1">
                                    <field name="x_level" required="1"/>
                                    <field name="x_trigger_after" widget="percentage"/>
                                    <field name="x_notify_users" widget="many2many_tags"/>
                                    <field name="x_notify_groups" widget="many2many_tags"/>
                                    <field name="x_auto_reassign"/>
                                    <field name="x_reassign_to" invisible="not x_auto_reassign"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter reload_on_follower="True"/>
            </form>
        </field>
    </record>

    <!-- Team List View (standalone, not inherited) -->
    <record id="view_technical_service_team_list_new" model="ir.ui.view">
        <field name="name">technical.service.team.list.standalone</field>
        <field name="model">maintenance.team</field>
        <field name="priority">25</field>
        <field name="arch" type="xml">
            <list string="Service Teams" create="1" delete="1">
                <field name="name" class="fw-bold"/>
                <field name="x_specialization"/>
                <field name="x_shift_type"/>
                <field name="x_current_shift"/>
                <field name="x_member_count"/>
                <field name="x_active_requests"/>
                <field name="x_pending_requests"/>
                <field name="x_avg_resolution_time" widget="float_time"/>
            </list>
        </field>
    </record>

    <!-- Team Form View -->
    <record id="view_technical_service_team_form" model="ir.ui.view">
        <field name="name">technical.service.team.form</field>
        <field name="model">maintenance.team</field>
        <field name="inherit_id" ref="maintenance.maintenance_team_view_form"/>
        <field name="arch" type="xml">
            <!-- Add team details -->
            <xpath expr="//group" position="replace">
                <group>
                    <group string="Team Information">
                        <field name="x_specialization"/>
                        <field name="x_shift_type"/>
                        <field name="x_current_shift"
                               invisible="x_shift_type not in ['shift', '24x7']"/>
                    </group>
                    <group string="Coverage">
                        <field name="x_campus_ids" widget="many2many_tags"/>
                        <field name="x_member_count"/>
                    </group>
                </group>
                <group>
                    <group string="Auto Assignment">
                        <field name="x_auto_assign"/>
                        <field name="x_assignment_method"
                               invisible="not x_auto_assign"
                               required="x_auto_assign"/>
                    </group>
                    <group string="Workload">
                        <field name="x_active_requests"/>
                        <field name="x_pending_requests"/>
                        <field name="x_avg_resolution_time" widget="float_time"/>
                    </group>
                </group>
            </xpath>

            <!-- Add notebook -->
            <xpath expr="//sheet/group" position="after">
                <notebook>
                    <page string="Team Members" name="members">
                        <field name="x_member_ids">
                            <list editable="bottom" create="1" delete="1">
                                <field name="employee_id" required="1"/>
                                <field name="user_id" readonly="1"/>
                                <field name="x_skill_level"/>
                                <field name="x_shift"/>
                                <field name="x_availability_status"/>
                                <field name="x_is_available" readonly="1"/>
                                <field name="x_active_request_count"/>
                                <field name="x_completed_today"/>
                            </list>
                        </field>
                    </page>
                    <page string="Skills &amp; Certifications" name="skills">
                        <field name="x_member_ids">
                            <list editable="bottom">
                                <field name="employee_id" readonly="1"/>
                                <field name="x_skill_category_ids" widget="many2many_tags"/>
                                <field name="x_certifications"/>
                                <field name="x_coverage_campus_ids" widget="many2many_tags"/>
                            </list>
                        </field>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_technical_service_sla" model="ir.actions.act_window">
        <field name="name">SLA Policies</field>
        <field name="res_model">technical_service.sla</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'default_active': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first SLA policy!
            </p>
            <p>
                Define response and resolution time targets based on priority levels.
            </p>
        </field>
    </record>

    <record id="action_technical_service_team" model="ir.actions.act_window">
        <field name="name">Service Teams</field>
        <field name="res_model">maintenance.team</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="view_id" ref="view_technical_service_team_list_new"/>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your service teams!
            </p>
            <p>
                Organize technicians into teams with skills and coverage areas.
            </p>
        </field>
    </record>

    <!-- Explicit view definitions for action -->
    <record id="action_technical_service_team_view_list" model="ir.actions.act_window.view">
        <field name="sequence" eval="1"/>
        <field name="view_mode">list</field>
        <field name="view_id" ref="view_technical_service_team_list_new"/>
        <field name="act_window_id" ref="action_technical_service_team"/>
    </record>

    <record id="action_technical_service_team_view_kanban" model="ir.actions.act_window.view">
        <field name="sequence" eval="2"/>
        <field name="view_mode">kanban</field>
        <field name="act_window_id" ref="action_technical_service_team"/>
    </record>

    <record id="action_technical_service_team_view_form" model="ir.actions.act_window.view">
        <field name="sequence" eval="3"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_technical_service_team_form"/>
        <field name="act_window_id" ref="action_technical_service_team"/>
    </record>
</odoo>